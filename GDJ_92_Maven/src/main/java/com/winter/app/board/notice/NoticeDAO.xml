<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <!-- namespace의 이름은 사용하려는 DAO의 풀패키지명과 동일하게 작성 -->
 <mapper namespace="com.winter.app.board.notice.NoticeDAO">
 
 	<resultMap type="NoticeVO" id="detailResult">
 		<id column="BOARD_NUM" property="boardNum"/>
 		<result column="BOARD_TITLE" property="boardTitle"></result>
 		<result column="BOARD_WRITER" property="boardWriter"></result>
 		<result column="BOARD_CONTENTS" property="boardContents"></result>
 		<result column="BOARD_DATE" property="boardDate"></result>
 		<result column="BOARD_HIT" property="boardHit"></result>
 		
		<!-- association : 1:1 관계 매핑에 사용 -->
		<!-- 내부에 또 다른 VO의 필드를 매핑할 수 있음 -->
		<association property="boardFileVO" javaType="BoardFileVO">
			<id column="FILE_NUM" property="fileNum"/>
			<result column="ORI_NAME" property="oriName"/>
			<result column="SAVE_NAME" property="saveName"/>
		</association>
 	</resultMap>
 	
 	<!-- 공통 쿼리를 만들어 놔서 필요한 곳에 가져다가 쓸 수 있음 / id 값을 주고 refid로 id 값을 찾아서 사용함 -->
 	<!-- 지금 여기서는 title, contents, writer 중에 하나를 골라서 검색기능 만드는 -->
 	<sql id="search">
 		<where>
	 		<choose>
				<when test="kind == 'k1'">
	 				BOARD_TITLE
	 			</when>
	 			<when test="kind == 'k2'">
	 				BOARD_CONTENTS
	 			</when>
	 			<otherwise>
	 				BOARD_WRITER
	 			</otherwise>
	 		</choose>
 		 LIKE CONCAT('%', #{keyword}, '%')
 		</where> 
 			
 	</sql>
 
 	<!-- id : 이 SQL문을 list()라는 이름으로 매퍼 인터페이스에서 호출할 수 있게 함 -->
 	<!-- resultType :  SQL 실행 결과가 NoticeVO 객체에 자동으로 매핑
 						(컬럼명과 NoticeVO 필드명이 일치해야 자동 매핑됨) -->
 	<select id="list" resultType="NoticeVO" parameterType="Pager">
 		SELECT * FROM NOTICE 
 		<include refid="search"></include>
 		ORDER BY BOARD_NUM DESC
 		LIMIT #{startIndex}, #{endIndex}
 	</select>
 	<!-- LIMIT : {startIndex}부터 {endIndex}개 출력 -->
 	
 	<select id="totalCount" resultType="Long">
 		SELECT COUNT(BOARD_NUM) FROM NOTICE 
 			<include refid="search"></include>
 	</select>
 	
 	<!-- #{} 안에는 getter에서 get을 빼고 카멜케이스로 작성 -->
 	<!-- 결과물을 담아서 이동 = resultType (조회하는 결과가 마다 다르기 때문에) -->
 	<select id="detail" parameterType="NoticeVO" resultMap="detailResult">
 		SELECT * FROM NOTICE 
 		LEFT JOIN NOTICEFILES F USING(BOARD_NUM)
 		WHERE BOARD_NUM=#{boardNum}
 	</select>
 
 	<!-- ID는 DAO의 메서드명과 동일하게 작성 -->
	 <insert id="insert" parameterType="NoticeVO" useGeneratedKeys="true" keyProperty="boardNum">
	 	INSERT INTO NOTICE
	 	(BOARD_NUM, BOARD_TITLE, BOARD_CONTENTS, BOARD_WRITER, BOARD_DATE, BOARD_HIT)
	 	VALUES
	 	(NULL, #{boardTitle}, #{boardContents}, #{boardWriter}, now(), 0)
	 </insert>
	 
	 <!-- 파일을 저장하는 -->
	 <insert id="insertFile" parameterType="BoardFileVO">
	 	INSERT INTO NOTICEFILES
	 		(FILE_NUM, ORI_NAME, SAVE_NAME, BOARD_NUM)
	 	VALUES
	 		(NULL, #{oriName}, #{saveName}, #{boardNum})
	 </insert>
	 
	 <update id="update" parameterType="NoticeVO">
	 	UPDATE NOTICE SET 
	 		BOARD_TITLE = #{boardTitle},
	 		BOARD_CONTENTS = #{boardContents}
	 		WHERE BOARD_NUM = #{boardNum}
	 </update>
	 
	 <delete id="delete" parameterType="NoticeVO">
	 	DELETE FROM NOTICE
	 	WHERE BOARD_NUM = #{boardNum}
	 </delete>
 
 
 
 </mapper>